# Quick Reference - Setup Scripts

## One-Command Setup

```bash
# Interactive setup (recommended for first time)
./scripts/setup-apso-betterauth.sh

# Automated setup
./scripts/setup-apso-betterauth.sh \
  --project-name my-saas \
  --backend-port 3001 \
  --frontend-port 3003
```

## Daily Commands

```bash
# Verify setup
./scripts/verify-setup.sh

# View logs
./scripts/view-logs.sh both

# Restart servers
./scripts/restart-servers.sh

# Stop servers
./scripts/stop-servers.sh
```

## What Each Script Does

| Script | Purpose | When to Use |
|--------|---------|-------------|
| `setup-apso-betterauth.sh` | Complete setup | First time, or full reset |
| `verify-setup.sh` | Health check | After setup, debugging |
| `stop-servers.sh` | Stop dev servers | End of day, before restart |
| `restart-servers.sh` | Restart servers | After code changes to backend |
| `view-logs.sh` | Show logs | Debugging, monitoring |

## Setup Flow

```
1. Run setup script
   ./scripts/setup-apso-betterauth.sh

2. Answer prompts
   - Project name: my-saas
   - Database name: my_saas_dev (default)
   - Database password: (optional)
   - Confirm: Y

3. Wait ~5 minutes
   - Prerequisites checked
   - Backend created
   - Frontend created
   - Database initialized
   - Servers started

4. Verify
   ./scripts/verify-setup.sh

5. Access
   - Frontend: http://localhost:3003
   - Backend: http://localhost:3001
```

## Troubleshooting

```bash
# Full diagnostic
./scripts/verify-setup.sh --verbose

# Check logs
./scripts/view-logs.sh both

# Nuclear option (full reset)
./scripts/stop-servers.sh
rm -rf backend frontend
psql -U postgres -c "DROP DATABASE IF EXISTS my_saas_dev;"
./scripts/setup-apso-betterauth.sh
```

## Common Options

### Custom Ports

```bash
./scripts/setup-apso-betterauth.sh \
  --backend-port 4000 \
  --frontend-port 4001
```

### Skip Steps

```bash
# Skip npm install (faster if deps already installed)
./scripts/setup-apso-betterauth.sh --skip-install

# Skip database setup
./scripts/setup-apso-betterauth.sh --skip-db
```

### Custom Database

```bash
./scripts/setup-apso-betterauth.sh \
  --db-name custom_db \
  --db-user myuser \
  --db-password mypass
```

## File Locations

### Project Structure
```
lightbulb-v2/
├── backend/               # NestJS + Apso backend
│   ├── src/
│   │   ├── auth/         # BetterAuth integration
│   │   ├── config/       # TypeORM config
│   │   └── main.ts       # Entry point
│   ├── .env              # Backend env vars
│   └── package.json
├── frontend/             # Next.js frontend
│   ├── app/
│   │   ├── login/        # Login page
│   │   ├── api/auth/     # Auth API route
│   │   └── page.tsx      # Home page
│   ├── lib/
│   │   └── auth-client.ts # BetterAuth client
│   ├── .env.local        # Frontend env vars
│   └── package.json
└── scripts/              # Automation scripts
    ├── setup-apso-betterauth.sh
    ├── verify-setup.sh
    ├── stop-servers.sh
    ├── restart-servers.sh
    └── view-logs.sh
```

### Log Files
```
/tmp/backend-dev.log       # Backend runtime
/tmp/frontend-dev.log      # Frontend runtime
/tmp/backend-install.log   # Backend install
/tmp/frontend-create.log   # Frontend creation
/tmp/db-create.log         # Database creation
/tmp/migration-run.log     # Migrations
```

### PID Files
```
lightbulb-v2/dev-servers.pid  # Server process IDs
```

## Environment Variables

### Backend (.env)
```bash
DB_HOST=localhost
DB_PORT=5432
DB_USER=postgres
DB_PASSWORD=
DB_NAME=my_saas_dev

PORT=3001
NODE_ENV=development
FRONTEND_URL=http://localhost:3003

JWT_SECRET=<auto-generated>
AUTH_SECRET=<auto-generated>
```

### Frontend (.env.local)
```bash
NEXT_PUBLIC_API_URL=http://localhost:3001
BETTER_AUTH_SECRET=<auto-generated>
BETTER_AUTH_URL=http://localhost:3003
```

## Color Legend

Scripts use colored output:

- Green (✓) = Success
- Red (✗) = Error
- Yellow (⚠) = Warning
- Blue (ℹ) = Info
- Cyan = Headers/URLs

## Exit Codes

| Code | Meaning |
|------|---------|
| 0 | Success |
| 1 | Error/Failure |

## Prerequisites

Before running setup:

```bash
# Check versions
node --version   # >= 18.0.0
npm --version    # >= 9.0.0
psql --version   # >= 13.0

# Install on macOS
brew install node postgresql
brew services start postgresql

# Install on Ubuntu
sudo apt-get install nodejs npm postgresql
sudo systemctl start postgresql
```

## Quick Fixes

### Port Already in Use
```bash
# Find process
lsof -i :3001

# Kill it
kill -9 <PID>

# Or use different port
./scripts/setup-apso-betterauth.sh --backend-port 4000
```

### Database Exists
```bash
# Drop it
psql -U postgres -c "DROP DATABASE my_saas_dev;"

# Or let script prompt you
./scripts/setup-apso-betterauth.sh
```

### PostgreSQL Not Running
```bash
# macOS
brew services start postgresql

# Linux
sudo systemctl start postgresql

# Check
pg_isready
```

### Servers Not Starting
```bash
# Check logs
./scripts/view-logs.sh both

# Try rebuilding
cd backend && npm run build
cd frontend && npm run build

# Restart
./scripts/restart-servers.sh
```

## Help

```bash
# Script help
./scripts/setup-apso-betterauth.sh --help
./scripts/verify-setup.sh --help

# Full documentation
cat scripts/README.md
```

## Next Steps After Setup

1. Open http://localhost:3003
2. Click "Sign Up" to create account
3. Enter email, password, name
4. Sign in
5. See session info on home page
6. Start building features

## Development Workflow

```bash
# Morning
cd lightbulb-v2
./scripts/verify-setup.sh
./scripts/view-logs.sh both &

# During development
# (edit files, servers auto-reload)

# If backend changes need restart
./scripts/restart-servers.sh

# Debugging
./scripts/view-logs.sh backend

# End of day
./scripts/stop-servers.sh
```

## Integration with Apso

After initial setup, use Apso CLI to generate code:

```bash
cd backend

# Generate CRUD from schema
apso generate crud --entity Account
apso generate crud --entity User
apso generate crud --entity Session

# Generate API docs
apso generate docs

# Deploy to AWS
apso deploy production
```

## Integration with BetterAuth

The setup includes:

- Email/password authentication
- OAuth providers (Google, GitHub) - ready to configure
- Session management
- Password hashing
- Email verification (if SMTP configured)
- Protected routes
- JWT tokens

Add OAuth:

1. Get client ID/secret from provider
2. Add to backend `.env`:
   ```
   GOOGLE_CLIENT_ID=xxx
   GOOGLE_CLIENT_SECRET=xxx
   ```
3. Restart backend
4. Use in frontend:
   ```tsx
   import { signIn } from '@/lib/auth-client';

   await signIn.social({ provider: 'google' });
   ```

## Support

- Scripts README: `scripts/README.md`
- Project Quickstart: `QUICKSTART.md`
- Apso Docs: `apso/apso-schema-guide.md`
- SaaS Stack: `saas/saas-tech-stack.md`
